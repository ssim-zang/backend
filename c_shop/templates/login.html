{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'css/loginstyle.css' %}">
    <script src="{% static 'js/login.js' %}" defer></script>
    <script src="{% static 'js/jquery.min.js' %}" defer></script>
    <title>Login</title>
</head>
<body>
    <!-- 전체 박스 -->
    <div class="wrapper">
        <!-- 실질적인 내용 -->
        <div class="container">
            <!-- sign up 컨테이너(회원가입) -->
          <div class="sign-up-container">
            <form onSubmit="return signUp(this);">
                {% csrf_token %}
              <h1>Create Account</h1>
              <span>or use your Student ID for registration</span>
              <input name="name" type="text" placeholder="Name" >
              <!-- <input type="text" placeholder="Student ID"> -->
              <input name="id" type="ID" placeholder="ID">
              <input name="pw" type="password" placeholder="Password">
              <input name="pwCheck" type="password" placeholder="Password Check">
              <!-- 재 확인용 -->

              <button class="form_btn">Sign Up</button>
            </form>
          </div>

          <!-- sign in 컨테이너(로그인) -->
          <div class="sign-in-container">
            <form onSubmit="return signIn(this);">
                {% csrf_token %}
              <h1>Sign In</h1>
              <span>or use your account</span>
              <input name="id" type="ID" placeholder="ID" id="signInId">
              <input name="pw" type="password" placeholder="Password" id="signInPw">
              <button class="form_btn" >Sign In</button>
            </form>
          </div>

          <div class="overlay-container">
            <div class="overlay-left">
              <!-- sign in(로그인)을 위한 오버레이  -->
              <h1>Welcome Back</h1>
              <p>To keep connected with us please login with your personal info</p>
              <button id="signIn" class="overlay_btn">Sign In</button>
            </div>

            <div class="overlay-right">
              <!-- sign up(회원가입) 을 위한 오버레이 -->
              <h1>Hello, Friend</h1>
              <p>Enter your personal details and start community with us</p>
              <button id="signUp" class="overlay_btn">Sign Up</button>
            </div>

          </div>
        </div>
      </div>
    <script>
        function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = cookies[i].trim();
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    var csrftoken = getCookie('csrftoken');

    function csrfSafeMethod(method) {
        // these HTTP methods do not require CSRF protection
        return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
    }
    $.ajaxSetup({
        beforeSend: function(xhr, settings) {
            if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                xhr.setRequestHeader("X-CSRFToken", csrftoken);
            }
        }
    });
        
        function signIn(obj){
            if(!obj.id.value){
                alert("id를 입력해주세요.");
                return false;
            }
            if(!obj.pw.value){
                alert("password를 입력해주세요.");
                return false;
            }
            $.ajax({
                type: "POST",
                url: '/member/login',
                data: {
                    'id': obj.id.value,
                    'pw': obj.pw.value,
                'csrfmiddlewaretoken':  csrftoken
                },
                success: function(ajax_data) {
                    window.location.href = '/';
                },
                error: function (xhr, status, error) {
                    alert("ID 혹은 Password를 확인해주세요.");
                }
            });
            return false;
        }
        function signUp(obj){
            if(!obj.name.value || !obj.id.value || !obj.pw.value){
                alert("모두 입력해주세요.");
                return false;
            }
            if(obj.pw.value != obj.pwCheck.value){
                alert("비밀번호를 확인해주세요.");
                return false;
            }
            $.ajax({
                type: "POST",
                url: '/member/create',
                data: {
                    'id': obj.id.value,
                    'pw': obj.pw.value,
                    'name': obj.name.value,
                'csrfmiddlewaretoken':  csrftoken
                },
                success: function(ajax_data) {
                    window.location.href = '/';
                },
                error: function (xhr, status, error) {
                    alert("중복된 ID입니다.");
                }
            });
        return false;
        }
    </script>
</body>
</html>